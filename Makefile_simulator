CXX      ?= g++
TARGET   := hologram_simulator
SRCS     := hologram_simulator.cpp raytrace_frame.cpp
OBJS     := $(SRCS:.cpp=.o)

# Base flags
CPPFLAGS ?=
CXXFLAGS ?= -O3 -std=c++17 -Wall -Wextra
LDFLAGS  ?=
LDLIBS   ?=

# --- OpenMP handling ---
UNAME_S := $(shell uname -s)

ifeq ($(UNAME_S),Darwin)
  # macOS (clang): requires libomp (e.g., brew install libomp)
  OMP_CXXFLAGS := -Xpreprocessor -fopenmp
  OMP_LDFLAGS  := -lomp
else
  # Linux / most GCC setups
  OMP_CXXFLAGS := -fopenmp
  OMP_LDFLAGS  := -fopenmp
endif

CXXFLAGS += $(OMP_CXXFLAGS)
LDFLAGS  += $(OMP_LDFLAGS)

.PHONY: all clean

all: $(TARGET)

$(TARGET): $(OBJS)
	$(CXX) $(OBJS) $(LDFLAGS) $(LDLIBS) -o $@

%.o: %.cpp
	$(CXX) $(CPPFLAGS) $(CXXFLAGS) -c $< -o $@

clean:
	rm -f $(OBJS) $(TARGET)
